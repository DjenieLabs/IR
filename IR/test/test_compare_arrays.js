/*
 * Test the protocol-decoder
 * by Roger Camargo - Dez 2016
 */
var assert = require('assert');

var requirejs = require('requirejs');
requirejs.config({
  paths:{
    "decoder": __dirname + "/../libs/protocol-decoder",
    "NEC": __dirname + '/../libs/NEC',
    "helper": __dirname + '/../libs/helpers',
    "RAW": __dirname + '/../libs/RAW',
  },
  catchError: true
});

var Decoder = requirejs('decoder');

describe("IR.Decoder", function() {

    /* Test 1
     * Using the same data from the SAMSUNG REMOTE CONTROL - Button Volume +
     */
    it('Compares the same buffer twice (Volume Up)', function(done) {

      // Data 1 from Volume +
      // BB01010100000000000101010000000000010101000000000000000001010101010 35 10000 3 01010100000000000101010000
      var volumeUp_data1 = ["4345","4345","395","395","395","395","395","395","395","395","395","1185","395","1185","395","395","395","395","395","1185","395","1185","395","1185","395","1185","395","395","395","395","395","395","395","395","395","4345","395","395","395","395","395","395","395","395","395","1185","395","1185","395","1185","395","395","395","1185","395","1185","395","1185","395","395","395","395","395","395","395","395","395","1185","395","395","395","395","395","395","395","1185","395","54905","4345","4345","395","395","395","395","395","395","395","395","395","1185","395","1185","395","395","395","395","395","1185","395","1185","395","1185","395","1185","395","395","395","395","395","395","395","395","395","4345","395","395","395","395","395","395","395","395","395","1185","395","1185","395","1185","395","395","395","1185","395","1185","395","1185","395","395","395","395","395","395","395","395","395","1185","395","395","395","395","395","395","395","1185","395","54905","4345","4345","395","395","395","395","395","395","395","395","395","1185","395","1185","395","395","395","395","395","1185","395","1185","395","1185","395","1185","395","395","395","395","395","395","395","395","395","4345"];

      assert.equal(true, Decoder.compareRawArrays(volumeUp_data1, volumeUp_data1));

      done();
      
    });

    

    /**
     * Test 2
     * Channel Up
     */
    it('Compares multiple buffers of the same button (Channel +)', function(done) {
      // Length: 135
      var channelUp_data1 = ["4080", "4080", "510", "1530", "510", "1530", "510", "1530", "510", "510", 
                            "510", "510", "510", "510", "510", "510", "510", "510", "510", "1530", 
                            "510", "1530", "510", "1530", "510", "510", "510", "510", "510", "510", 
                            "510", "510", "510", "510", "510", "510", "510", "1530", "510", "510", 
                            "510", "510", "510", "1530", "510", "510", "510", "510", "510", "510", 
                            "510", "1530", "510", "510", "510", "1530", "510", "1530", "510", "510", 
                            "510", "1530", "510", "1530", "510", "1530", "510", "46410", "4080", "4080", 
                            "510", "1530", "510", "1530", "510", "1530", "510", "510", "510", "510", 
                            "510", "510", "510", "510", "510", "510", "510", "1530", "510", "1530", 
                            "510", "1530", "510", "510", "510", "510", "510", "510", "510", "510",
                            "510", "510", "510", "510", "510", "1530", "510", "510", "510", "510", 
                            "510", "1530", "510", "510", "510", "510", "510", "510", "510", "1530", 
                            "510", "510", "510", "1530", "510", "1530", "510", "510", "510", "1530", 
                            "510", "1530", "510", "1530", "510"];
      // Length: 135
      var channelUp_data2 = ["4008", "4008", "501", "1503", "501", "1503", "501", "1503", "501", "501", 
                            "501", "501", "501", "501", "501", "501", "501", "501", "501", "1503", 
                            "501", "1503", "501", "1503", "501", "501", "501", "501", "501", "501", 
                            "501", "501", "501", "501", "501", "501", "501", "1503", "501", "501", 
                            "501", "501", "501", "1503", "501", "501", "501", "501", "501", "501", 
                            "501", "1503", "501", "501", "501", "1503", "501", "1503", "501", "501", 
                            "501", "1503", "501", "1503", "501", "1503", "501", "46593", "4008", "4008", 
                            "501", "1503", "501", "1503", "501", "1503", "501", "501", "501", "501", 
                            "501", "501", "501", "501", "501", "501", "501", "1503", "501", "1503", 
                            "501", "1503", "501", "501", "501", "501", "501", "501", "501", "501",
                            "501", "501", "501", "501", "501", "1503", "501", "501", "501", "501", 
                            "501", "1503", "501", "501", "501", "501", "501", "501", "501", "1503", 
                            "501", "501", "501", "1503", "501", "1503", "501", "501", "501", "1503", 
                            "501", "1503", "501", "1503", "501"];

       var channelUp_data3 = ["4473", "3976", "497", "1491", "497", "1491", "497", "1491", "497", "497", 
                              "497", "497", "497", "497", "497", "497", "497", "497", "497", "1491", 
                              "497", "1491", "497", "1491", "497", "497", "497", "497", "497", "497", 
                              "497", "497", "497", "497", "497", "497", "497", "1491", "497", "497", 
                              "497", "497", "497", "1491", "497", "497", "497", "497", "497", "497", 
                              "497", "1491", "497", "497", "497", "1491", "497", "1491", "497", "497", 
                              "497", "1491", "497", "1491", "497", "1491", "497", "46221", "4473", "3976", 
                              "497", "1491", "497", "1491", "497", "1491", "497", "497", "497", "497", 
                              "497", "497", "497", "497", "497", "497", "497", "1491", "497", "1491", 
                              "497", "1491", "497", "497", "497", "497", "497", "497", "497", "497",
                              "497", "497", "497", "497", "497", "1491", "497", "497", "497", "497", 
                              "497", "1491", "497", "497", "497", "497", "497", "497", "497", "1491", 
                              "497", "497", "497", "1491", "497", "1491", "497", "497", "497", "1491", 
                              "497", "1491", "497", "1491", "497"];

      assert.equal(true, Decoder.compareRawArrays(channelUp_data1, channelUp_data2));
      assert.equal(true, Decoder.compareRawArrays(channelUp_data1, channelUp_data3));
      done();
    });

    /**
     * Test 3
     * Number 1
     */
    it('Compares multiple buffers of the same button (Button 1)', function(done) {
      // Length 135
      var NumOne_data1 = ["4248", "4248", "531", "1593", "531", "1593", "531", "1593", "531", "531", 
                          "531", "531", "531", "531", "531", "531", "531", "531", "531", "1593", 
                          "531", "1593", "531", "1593", "531", "531", "531", "531", "531", "531", 
                          "531", "531", "531", "531", "531", "531", "531", "531", "531", "1593", 
                          "531", "531", "531", "531", "531", "531", "531", "531", "531", "531", 
                          "531", "1593", "531", "1593", "531", "531", "531", "1593", "531", "1593", 
                          "531", "1593", "531", "1593", "531", "1593", "531", "46728", "4248", "4248", 
                          "531", "1593", "531", "1593", "531", "1593", "531", "531", "531", "531", 
                          "531", "531", "531", "531", "531", "531", "531", "1593", "531", "1593", 
                          "531", "1593", "531", "531", "531", "531", "531", "531", "531", "531",
                          "531", "531", "531", "531", "531", "531", "531", "1593", "531", "531", 
                          "531", "531", "531", "531", "531", "531", "531", "531", "531", "1593", 
                          "531", "1593", "531", "531", "531", "1593", "531", "1593", "531", "1593", 
                          "531", "1593", "531", "1593", "531"];

      // Length 135
      var NumOne_data2 = ["4184", "4184", "523", "1569", "523", "1569", "523", "1569", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "523", "523", "1569", 
                          "523", "1569", "523", "1569", "523", "523", "523", "523", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "523", "523", "1569", 
                          "523", "523", "523", "523", "523", "523", "523", "523", "523", "523", 
                          "523", "1569", "523", "1569", "523", "523", "523", "1569", "523", "1569", 
                          "523", "1569", "523", "1569", "523", "1569", "523", "46547", "4184", "4184", 
                          "523", "1569", "523", "1569", "523", "1569", "523", "523", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "1569", "523", "1569", 
                          "523", "1569", "523", "523", "523", "523", "523", "523", "523", "523",
                          "523", "523", "523", "523", "523", "523", "523", "1569", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "523", "523", "1569", 
                          "523", "1569", "523", "523", "523", "1569", "523", "1569", "523", "1569", 
                          "523", "1569", "523", "1569", "523"];

      // Length 135
      var NumOne_data3 = ["4509", "4008", "501", "1503", "501", "1503", "501", "1503", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "501", "501", "1503", 
                          "501", "1503", "501", "1503", "501", "501", "501", "501", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "501", "501", "1503", 
                          "501", "501", "501", "501", "501", "501", "501", "501", "501", "501", 
                          "501", "1503", "501", "1503", "501", "501", "501", "1503", "501", "1503", 
                          "501", "1503", "501", "1503", "501", "1503", "501", "46593", "4008", "4008", 
                          "501", "1503", "501", "1503", "501", "1503", "501", "501", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "1503", "501", "1503", 
                          "501", "1503", "501", "501", "501", "501", "501", "501", "501", "501",
                          "501", "501", "501", "501", "501", "501", "501", "1503", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "501", "501", "1503", 
                          "501", "1503", "501", "501", "501", "1503", "501", "1503", "501", "1503", 
                          "501", "1503", "501", "1503", "501"];

      assert.equal(true, Decoder.compareRawArrays(NumOne_data1, NumOne_data2));
      assert.equal(true, Decoder.compareRawArrays(NumOne_data1, NumOne_data3));
      done();
    });

    /**
     * Test 4
     * Power Button
     */
    it("Compares multiple buffers of the same button (Power Button)", function(done){
      powerButton_data1 = ["4184", "4184", "523", "1569", "523", "1569", "523", "1569", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "523", "523", "1569", 
                          "523", "1569", "523", "1569", "523", "523", "523", "523", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "1569", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "523", "523", "523", 
                          "523", "1569", "523", "523", "523", "1569", "523", "1569", "523", "1569", 
                          "523", "1569", "523", "1569", "523", "1569", "523", "46547", "4184", "4184", 
                          "523", "1569", "523", "1569", "523", "1569", "523", "523", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "1569", "523", "1569", 
                          "523", "1569", "523", "523", "523", "523", "523", "523", "523", "523",
                          "523", "523", "523", "523", "523", "1569", "523", "523", "523", "523", 
                          "523", "523", "523", "523", "523", "523", "523", "523", "523", "1569", 
                          "523", "523", "523", "1569", "523", "1569", "523", "1569", "523", "1569", 
                          "523", "1569", "523", "1569", "523"];

      powerButton_data2 = ["4008", "4008", "501", "1503", "501", "1503", "501", "1503", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "501", "501", "1503", 
                          "501", "1503", "501", "1503", "501", "501", "501", "501", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "1503", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "501", "501", "501", 
                          "501", "1503", "501", "501", "501", "1503", "501", "1503", "501", "1503", 
                          "501", "1503", "501", "1503", "501", "1503", "501", "46593", "4008", "4008", 
                          "501", "1503", "501", "1503", "501", "1503", "501", "501", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "1503", "501", "1503", 
                          "501", "1503", "501", "501", "501", "501", "501", "501", "501", "501",
                          "501", "501", "501", "501", "501", "1503", "501", "501", "501", "501", 
                          "501", "501", "501", "501", "501", "501", "501", "501", "501", "1503", 
                          "501", "501", "501", "1503", "501", "1503", "501", "1503", "501", "1503", 
                          "501", "1503", "501", "1503", "501"];

      powerButton_data3 = ["4473", "3976", "497", "1491", "497", "1491", "497", "1491", "497", "497", 
                          "497", "497", "497", "497", "497", "497", "497", "497", "497", "1491", 
                          "497", "1491", "497", "1491", "497", "497", "497", "497", "497", "497", 
                          "497", "497", "497", "497", "497", "497", "497", "1491", "497", "497", 
                          "497", "497", "497", "497", "497", "497", "497", "497", "497", "497", 
                          "497", "1491", "497", "497", "497", "1491", "497", "1491", "497", "1491",
                          "497", "1491", "497", "1491", "497", "1491", "497", "46718", "3976", "4473", 
                          "497", "1491", "497", "1491", "497", "1491", "497", "497", "497", "497", 
                          "497", "497", "497", "497", "497", "497", "497", "1491", "497", "1491", 
                          "497", "1491", "497", "497", "497", "497", "497", "497", "497", "497",
                          "497", "497", "497", "497", "497", "1491", "497", "497", "497", "497", 
                          "497", "497", "497", "497", "497", "497", "497", "497", "497", "1491", 
                          "497", "497", "497", "1491", "497", "1491", "497", "1491", "497", "1491", 
                          "497", "1491", "497", "1491", "497"];

      assert.equal(true, Decoder.compareRawArrays(powerButton_data1, powerButton_data2));
      assert.equal(true, Decoder.compareRawArrays(powerButton_data1, powerButton_data3));
      done();
    });



    /**
     * Test DVD buttons
     */
    it("Compares the buttons 1 & 2 against each other of an Universal remote control in DVD Settings", function(done){
      // decoded: _010111100111111110011111111111111110__010111100111111110011111111111111110__010111100111111110011111111111111110
      let num1_v1 = ["2485","710","355","710","355","355","355","355","1065","1065","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","84490","2485","710","355","710","355","355","355","355","1065","1065","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","84490","2485","710","355","710","355","355","355","355","1065","1065","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710"];
      // decoded = _010111100111111110011111111111111110__010111100111111110011111111111111110
      let num1_v2 = ["2430","810","405","810","405","405","405","405","1215","1215","405","405","405","405","405","405","405","405","810","810","405","405","405","405","405","405","405","405","405","405","405","405","405","405","405","405","810","84645","2430","810","405","810","405","405","405","405","1215","1215","405","405","405","405","405","405","405","405","810","810","405","405","405","405","405","405","405","405","405","405","405","405","405","405","405","405","810"];


      // Number 2
      // decoded: _01011111001111111110011111111111111001__01011111001111111110011111111111111001__01011111001111111110011111111111111001
      let num2_v1 = ["2485","710","355","710","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","710","355","84135","2485","710","355","710","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","710","355","84135","2485","710","355","710","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","710","355"];

      let num2_v2 = ["2457","702","351","702","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","351","351","351","351","351","702","702","351","84240","2457","702","351","702","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","351","351","351","351","351","702","702","351","84240","2457","702","351","702","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","351","351","351","351","351","702","702","351","84240","2457","702","351","702","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","351","351","351","351","351","702","702","351","84240","2457","702","351","702","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","702","702","351","351","351","351","351","351","351","351","351","351"];
      // decoded: _01011111001111111110011111111111111001__01011111001111111110011111111111111001__01011111001111111110011111111111111001__01011111001111111110011111111111111001
      let num2_v3 = ["2485","710","355","710","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","710","355","84135","2485","710","355","710","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","710","355","84135","2485","710","355","710","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","710","355","84135","2485","710","355","710","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","710","710","355","355","355","355","355","355","355","355","355","355","355","355","355","355","710","710","355"];
      
      assert.equal(Decoder.compareRawArrays(num1_v1, num1_v2), true); 
      assert.equal(Decoder.compareRawArrays(num2_v1, num2_v2), true);  
      assert.equal(Decoder.compareRawArrays(num2_v2, num2_v3), true);  
      assert.equal(Decoder.compareRawArrays(num2_v1, num2_v3), true);  

      assert.equal(Decoder.compareRawArrays(num1_v1, num2_v1), false);
      assert.equal(Decoder.compareRawArrays(num1_v1, num2_v2), false);
      assert.equal(Decoder.compareRawArrays(num1_v1, num2_v3), false);
      assert.equal(Decoder.compareRawArrays(num1_v2, num2_v1), false);
      assert.equal(Decoder.compareRawArrays(num1_v2, num2_v2), false);
      assert.equal(Decoder.compareRawArrays(num1_v2, num2_v3), false);

      done();
    });
});
